language: cpp
os: linux
dist: focal

addons:
  sonarcloud:
    organization: "utilforever-github"
    token:
      secure: "p36Hk1fMZb22bGwFUhKHIRk/92zqWcqpejOhO8v7LN3a8iiOlnOYRFeQBDNyR+tHoBsBPPqUjgDk5Qt2lNEuIEaMPXgI7d63i6mkycCnZkeh2fiazNxdbXg0QWWILv0FuV2tDhHT/PdTkdtetEuEYWP4Alz82uam/MdqfqmfE8cxIEv/kA6oqW8elHl4DAaf6UQ1enIus4xBceAUmIyISNS1yc/qIT8zdVOcRmuObmpQL8PBxG70SR/QSTAwwetd81CiBB/MjRLwfGu0LBi51szxlNkhHTevklXm4csA5fdadjW45NvlrNcM9qlVQ5zJ8rB3Y/eo8KFiaAvAW1XSOA87ecPeVxaedx3kQ6DQVGcSZNwlzAhOR82QTRxFEFEYOxlT1McFqUCy42J/is0Qfs8Ijawyjy3VwjJFXC18wd4LHXnRDpGAMCq7ciItRBAlWeO6HIET5I/q8rl3psve1YN8d91Uxkd9t+N2pks7m+f9TJt0iszFGHBjDY2oVCobHtTBerFnYeu6WPNN2yHjk9FLmg1Cuzkk25IZ7gURONGUwmx2wCgAYTe8jCpl1CnTMcuf6x40wrY6F8jaMvWEcW4wHuFkt3i1tm9GtSGfynet7TfzoIbGK3rzAU9kiHOW5esCrdZMERmN4CX92rxgoceW0WCnVHZXnfwQ8qsgaiU="

script:
  # Install packages
  - sudo apt-get install -yq gcovr ggcov lcov curl
  # Configure build
  - mkdir build
  - cd build
  - cmake .. -DCMAKE_BUILD_TYPE=Debug -DBUILD_COVERAGE=ON
  # Wraps the compilation with the Build Wrapper to generate configuration
  # (used later by the SonarQube Scanner) into the "bw-output" folder
  - build-wrapper-linux-x86-64 --out-dir ../bw-output make all
  # Execute some tests
  - lcov --gcov-tool /usr/bin/gcov -c -i -d Tests/UnitTests -o base.info
  - bin/UnitTests
  - lcov --gcov-tool /usr/bin/gcov -c -d Tests/UnitTests -o test.info
  - lcov --gcov-tool /usr/bin/gcov -a base.info -a test.info -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -r coverage.info '*/Extensions/*' -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -r coverage.info '*/Includes/*' -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -r coverage.info '*/Libraries/*' -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -l coverage.info
  # And finally run the SonarQube analysis - read the "sonar-project.properties"
  # file to see the specific configuration
  - cd ..
  - sonar-scanner

cache:
  directories:
    - '$HOME/.sonar/cache'